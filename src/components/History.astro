---
import type { HistoryType } from "@/types/HistoryType";
import { HistoryTab } from "./react/HistoryTab";

const history = import.meta.glob("../assets/markdown/history/*.md", { eager: true });

type HistoryItem = {
  frontmatter: {
    title: string;
    subTitle: string;
    location: string;
    startDate: string;
    endDate: string;
    type: "education" | "experience";
  };
  compiledContent: () => Promise<string>;
};

const cards: HistoryType[] = await Promise.all(
  Object.values(history).map(async (item: unknown) => {
    const { frontmatter, compiledContent } = item as HistoryItem;
    const { title, subTitle, location, startDate, endDate, type } = frontmatter;
    const content = await compiledContent();
    return {
      title,
      subTitle,
      location,
      startDate,
      endDate,
      content,
      type,
    };
  })
);

const exp = cards.filter((c) => c.type === "experience");
const edu = cards.filter((c) => c.type === "education");
---

<HistoryTab client:load {exp} {edu} />
